package xjsnark.zkrollup1;

/*Generated by MPS */

import backend.auxTypes.UnsignedInteger;
import java.math.BigInteger;
import backend.structure.CircuitGenerator;

public class GetMerkleRoot {
  public UnsignedInteger leaf = new UnsignedInteger(32, new BigInteger("0"));
  public int k;
  public UnsignedInteger[] paths2_root;
  public UnsignedInteger[] paths2_root_pos;

  public UnsignedInteger out = new UnsignedInteger(32, new BigInteger("0"));

  public MultiMiMC7[] merkle_root;

  public GetMerkleRoot(UnsignedInteger leaff, int kk, UnsignedInteger[] pt, UnsignedInteger[] ptp) {
    this.leaf.assign(leaff, 32);
    this.k = kk;

    paths2_root = (UnsignedInteger[]) UnsignedInteger.createZeroArray(CircuitGenerator.__getActiveCircuitGenerator(), new int[]{k}, 32);
    paths2_root_pos = (UnsignedInteger[]) UnsignedInteger.createZeroArray(CircuitGenerator.__getActiveCircuitGenerator(), new int[]{k}, 32);
    merkle_root = new MultiMiMC7[k];
    this.paths2_root = pt;
    this.paths2_root_pos = ptp;

    UnsignedInteger[] in = (UnsignedInteger[]) UnsignedInteger.createZeroArray(CircuitGenerator.__getActiveCircuitGenerator(), new int[]{k}, 32);

    in[0].assign(paths2_root[0].subtract(paths2_root_pos[0].mul((paths2_root[0].subtract(leaf)))), 32);
    in[1].assign(leaf.subtract(paths2_root_pos[0].mul((leaf.subtract(paths2_root[0])))), 32);

    merkle_root[0] = new MultiMiMC7(2, 13, in);

    for (int v = 1; v < k; v++) {
      in[0].assign(paths2_root[v].subtract(paths2_root_pos[v].mul((paths2_root[v].subtract(merkle_root[v - 1].out)))), 32);
      in[1].assign(merkle_root[v - 1].out.subtract(paths2_root_pos[v].mul((merkle_root[v - 1].out.subtract(paths2_root[v])))), 32);
      merkle_root[v] = new MultiMiMC7(2, 13, in);
    }

    out.assign(merkle_root[k - 1].out, 32);

  }


}
